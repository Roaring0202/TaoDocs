<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Neurons - TaoDocs</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Bittensor Documentation covering the usage, installation, and development of Bittensor/skills adjacent.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.1.</strong> ReadMe</a></li><li class="chapter-item expanded "><a href="init.html"><strong aria-hidden="true">1.2.</strong> How should I read this?</a></li><li class="chapter-item expanded "><a href="Glossary.html"><strong aria-hidden="true">1.3.</strong> Basic Terminology</a></li><li class="chapter-item expanded "><a href="TheDataset.html"><strong aria-hidden="true">1.4.</strong> The Mountain</a></li><li class="chapter-item expanded "><a href="client_commands.html"><strong aria-hidden="true">1.5.</strong> Btcli Basics</a></li><li class="chapter-item expanded "><a href="delegation.html"><strong aria-hidden="true">1.6.</strong> Delegation Explanation</a></li><li class="chapter-item expanded "><a href="taonomics.html"><strong aria-hidden="true">1.7.</strong> TaoNomics</a></li></ol></li><li class="chapter-item expanded "><a href="baseline_skills.html"><strong aria-hidden="true">2.</strong> The Skills You'll Need</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rlhf.html"><strong aria-hidden="true">2.1.</strong> How to train an LLM?</a></li><li class="chapter-item expanded "><a href="md_book.html"><strong aria-hidden="true">2.2.</strong> Learn to write Documentation!</a></li><li class="chapter-item expanded "><a href="before_you_build.html"><strong aria-hidden="true">2.3.</strong> For Windows Users</a></li><li class="chapter-item expanded "><a href="Linux_basics.html"><strong aria-hidden="true">2.4.</strong> Linux Basics</a></li><li class="chapter-item expanded "><a href="md_book.html"><strong aria-hidden="true">2.5.</strong> A Guide to Writing Documentation</a></li></ol></li><li class="chapter-item expanded "><a href="finney.html"><strong aria-hidden="true">3.</strong> Finney and Prompting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="prompting_examples.html"><strong aria-hidden="true">3.1.</strong> Explanation of Prompt Scripts</a></li><li class="chapter-item expanded "><a href="prompting_example2.html"><strong aria-hidden="true">3.2.</strong> More Prompting Examples</a></li></ol></li><li class="chapter-item expanded "><a href="generate_signature.html"><strong aria-hidden="true">4.</strong> Information for Validation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="verify_signature.html"><strong aria-hidden="true">4.1.</strong> Verify Validator</a></li><li class="chapter-item expanded "><a href="gating_model.html"><strong aria-hidden="true">4.2.</strong> Gating Model</a></li><li class="chapter-item expanded "><a href="neuron.html" class="active"><strong aria-hidden="true">4.3.</strong> Neurons</a></li><li class="chapter-item expanded "><a href="core_validator_init.html"><strong aria-hidden="true">4.4.</strong> Core Validator Explanation</a></li><li class="chapter-item expanded "><a href="consensus.html"><strong aria-hidden="true">4.5.</strong> What is Consensus?</a></li></ol></li><li class="chapter-item expanded "><a href="Fine_tuning.html"><strong aria-hidden="true">5.</strong> Fine Tuning Examples/Mining</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="mining_models.html"><strong aria-hidden="true">5.1.</strong> Base Mining Models?</a></li><li class="chapter-item expanded "><a href="epochs.html"><strong aria-hidden="true">5.2.</strong> What's an Epoch?</a></li><li class="chapter-item expanded "><a href="miner_commands.html"><strong aria-hidden="true">5.3.</strong> Miner Commands</a></li><li class="chapter-item expanded "><a href="miner_analysis.html"><strong aria-hidden="true">5.4.</strong> Analysis of a Miner Template</a></li><li class="chapter-item expanded "><a href="Why_Cuda.html"><strong aria-hidden="true">5.5.</strong> Cuda PoW</a></li><li class="chapter-item expanded "><a href="keyfile_impl.html"><strong aria-hidden="true">5.6.</strong> Managing Keys</a></li><li class="chapter-item expanded "><a href="bounty_system.html"><strong aria-hidden="true">5.7.</strong> The Bounty System</a></li></ol></li><li class="chapter-item expanded "><a href="dataset_impl.html"><strong aria-hidden="true">6.</strong> GenesisTextDataSet and more on Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="dataset_mock.html"><strong aria-hidden="true">6.1.</strong> Mock DataSet</a></li><li class="chapter-item expanded "><a href="_logging_init.html"><strong aria-hidden="true">6.2.</strong> Looking at Logs</a></li><li class="chapter-item expanded "><a href="return_codes.html"><strong aria-hidden="true">6.3.</strong> Return Codes</a></li><li class="chapter-item expanded "><a href="response_codes.html"><strong aria-hidden="true">6.4.</strong> Response Codes</a></li><li class="chapter-item expanded "><a href="metagraph_impl.html"><strong aria-hidden="true">6.5.</strong> What's a MetaGraph?</a></li></ol></li><li class="chapter-item expanded "><a href="networking.html"><strong aria-hidden="true">7.</strong> Networking</a></li><li class="chapter-item expanded "><a href="registration.html"><strong aria-hidden="true">8.</strong> Registration</a></li><li class="chapter-item expanded "><a href="axon_init.html"><strong aria-hidden="true">9.</strong> Axons</a></li><li class="chapter-item expanded "><a href="dendrite_impl.html"><strong aria-hidden="true">10.</strong> Dendrites</a></li><li class="chapter-item expanded "><a href="prometheus_init.html"><strong aria-hidden="true">11.</strong> The Prometheus Module</a></li><li class="chapter-item expanded "><a href="receptor_impl.html"><strong aria-hidden="true">12.</strong> Receptors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">TaoDocs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="code-summary-of"><a class="header" href="#code-summary-of">Code Summary of</a></h1>
<p><code>_neuron/text/core_validator/__init__.py</code></p>
<p><strong>This Python script defines a class called neuron that acts as a core component in a distributed machine learning network. It is responsible for managing the network communication, the model training, and the reward distribution among peers.</strong> </p>
<h2 id="key-components"><a class="header" href="#key-components">Key Components</a></h2>
<h3 id="constants"><a class="header" href="#constants">Constants</a></h3>
<ul>
<li><code>__default_question_prompt__</code>: The default prompt used for generating questions from the network to evaluate other miners.</li>
<li><code>__default_base_prompt__</code>: The default base prompt injected before a question is completed by miners on the network.</li>
</ul>
<h3 id="class-definition-neuron"><a class="header" href="#class-definition-neuron">Class Definition: neuron</a></h3>
<p>This class is responsible for initializing and managing the network communication, model training, and reward distribution among the peers.</p>
<h4 id="methods"><a class="header" href="#methods">Methods:</a></h4>
<ul>
<li><code>check_config(cls, config)</code>: Validates the config namespace object and sets up the directories required for logging and reward models.</li>
<li><code>record_event(self, event)</code>: Records a forward event in the history queue and logs the event if specified in the config.</li>
<li><code>add_args(cls, parser)</code>: Adds the command-line arguments required for the neuron configuration.</li>
<li><code>config(cls)</code>: Generates the configuration object using the command-line arguments.</li>
<li><code>__init__(self)</code>: Initializes the neuron instance with the required components like subtensor, wallet, metagraph, tokenizer, reward model, gating model, dendrite pool, history queue, and axon.</li>
</ul>
<h4 id="forward-method"><a class="header" href="#forward-method">Forward Method:</a></h4>
<ul>
<li><code>forward(self, roles, messages, topk, random_sample_uids, train_gating_model, train_network, timeout)</code>: Queries the network for a response to the passed message using a gating model to select the best uids. Trains the gating model based on the rewards calculated for the successful completions and passes rewards backward for potential PPO.</li>
</ul>
<h2 id="execution-flow"><a class="header" href="#execution-flow">Execution Flow</a></h2>
<p>The script initializes a <code>neuron</code> instance and starts the network communication and model training. The neuron class takes care of the communication with other peers in the network and manages the mining process.</p>
<h3 id="additional-methods"><a class="header" href="#additional-methods">Additional Methods</a></h3>
<h4 id="inferenceself-messages-listdictstr-str---str"><a class="header" href="#inferenceself-messages-listdictstr-str---str">inference(self, messages: List[Dict[str, str]]) -&gt; str</a></h4>
<ul>
<li>Logs the inference process.</li>
<li>Pre-processes the messages to extract roles and contents.</li>
<li>Gets scores for the query from the gating model.</li>
<li>Gets uids for the query based on the scores.</li>
<li>Queries the network using the dendrite pool.</li>
<li>Applies the reward model to choose the best completion from the responses.</li>
<li>Returns the best completion.</li>
</ul>
<h4 id="trainself"><a class="header" href="#trainself">train(self)</a></h4>
<ul>
<li>Runs an infinite loop for training.
<ul>
<li>Queries the network for a random question and saves it.</li>
<li>Asks the network to complete the random question while training the gating network.</li>
<li>Syncs the metagraph and updates nominators.</li>
<li>Computes and sets the weights on the blockchain.</li>
</ul>
</li>
</ul>
<h4 id="compute_weightsself---tupletorchlongtensor-torchfloattensor"><a class="header" href="#compute_weightsself---tupletorchlongtensor-torchfloattensor">compute_weights(self) -&gt; Tuple[torch.LongTensor, torch.FloatTensor]</a></h4>
<ul>
<li>Computes the average reward for each uid across non-zero values using the rewards history.</li>
<li>Normalizes the rewards with a softmax and performs a moving average of the normalized rewards.</li>
<li>If the hotkeys have changed, resets the moving averaged scores for the new hotkeys.</li>
<li>Calculates the average reward for each uid across non-zero values.</li>
<li>Processes the raw weights to final_weights via subtensor limitations.</li>
<li>Returns the processed weights and uids.</li>
</ul>
<h3 id="execution-flow-1"><a class="header" href="#execution-flow-1">Execution Flow</a></h3>
<p>When the script is run, it initializes a <code>neuron</code> instance and enters an infinite loop, periodically calling the <code>train()</code> method to train the model and update the weights on the blockchain.</p>
<h1 id="in-conclusion"><a class="header" href="#in-conclusion">In Conclusion,</a></h1>
<p>There's a lot going on here, and I think it's best to investigate yourself, but the goal is to give people the proper tools and knowledge required to build on the network. This knowledge could be quite important depending on what your goals are here. </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="gating_model.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="core_validator_init.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="gating_model.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="core_validator_init.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
